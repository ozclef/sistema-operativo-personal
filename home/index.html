<body>
  <aside id="sidebar"></aside>

  <main id="main">
    <div id="vista-cards"></div>
    <div id="vista-articulo" style="display:none"></div>
    <div id="vista-mediana" style="display:none"></div>
  </main>


  
  <script>
    import { cargarMenu, renderMenu } from "./render.js";
import { cargarArticulos, renderCards, renderArticuloCompleto, renderMediana } from "./render.js";

let articulos = [];

async function init() {
  const menu = await cargarMenu();
  renderMenu(menu);

  articulos = await cargarArticulos();
  renderCards(articulos);
}

init();

// Exporta para que el HTML pueda invocar vistas
window.abrirArticulo = id => {
  const art = articulos.find(a => a.id === id);
  if (!art) return;

  art.vistas += 1;
  renderArticuloCompleto(art);
};

window.abrirMediana = id => {
  const art = articulos.find(a => a.id === id);
  if (!art) return;

  renderMediana(art);
};

window.volverMenu = () => {
  document.querySelector("#vista-articulo").style.display = "none";
  document.querySelector("#vista-mediana").style.display = "none";
  document.querySelector("#vista-cards").style.display = "grid";
};




    export async function cargarMenu() {
  const r = await fetch("./data/menu.json");
  return await r.json();
}

export async function cargarArticulos() {
  const r = await fetch("./data/articulos.json");
  return await r.json();
}

export function renderMenu(menu) {
  const side = document.querySelector("#sidebar");
  side.innerHTML = "";

  Object.keys(menu).forEach(grupo => {
    const h = document.createElement("h3");
    h.textContent = grupo.toUpperCase();
    side.appendChild(h);

    menu[grupo].forEach(op => {
      const a = document.createElement("div");
      a.className = "menu-item";
      a.textContent = op.label;
      a.onclick = () => console.log("Click en:", op.id);
      side.appendChild(a);
    });
  });
}

export function renderCards(articulos) {
  const cont = document.querySelector("#vista-cards");
  cont.style.display = "grid";
  cont.innerHTML = "";

  articulos.forEach(a => {
    const card = document.createElement("div");
    card.className = "card-prev";

    card.innerHTML = `
      <img src="${a.miniatura || 'https://i.imgur.com/xyz.png'}" class="preview-img">
      <h4>${a.titulo}</h4>
      <p>${a.contenido.slice(0, 80)}...</p>
      <button onclick="abrirMediana(${a.id})">Ver previo</button>
      <button onclick="abrirArticulo(${a.id})">Abrir</button>
    `;

    cont.appendChild(card);
  });
}

export function renderMediana(art) {
  document.querySelector("#vista-cards").style.display = "none";
  const v = document.querySelector("#vista-mediana");
  v.style.display = "block";

  v.innerHTML = `
    <button onclick="volverMenu()">Regresar</button>
    <h2>${art.titulo}</h2>
    <p>${art.contenido.slice(0, 200)}...</p>
    ${art.iframe ? `<iframe src="${art.iframe}" class="ifr"></iframe>` : ""}
    <button onclick="abrirArticulo(${art.id})">Abrir completo</button>
  `;
}

export function renderArticuloCompleto(art) {
  document.querySelector("#vista-cards").style.display = "none";
  document.querySelector("#vista-mediana").style.display = "none";

  const v = document.querySelector("#vista-articulo");
  v.style.display = "block";

  v.innerHTML = `
    <button onclick="volverMenu()">Regresar</button>
    <h1>${art.titulo}</h1>
    <p><strong>Fecha:</strong> ${art.fecha}</p>
    <p><strong>Vistas:</strong> ${art.vistas}</p>

    ${art.iframe ? `<iframe src="${art.iframe}" class="ifr-big"></iframe>` : ""}

    <article>${art.contenido}</article>
  `;
}


  </script>
  <script src="js/app.js"></script>


</body>
